<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>分时图</title>
    <style>
        div#main { display: flex;flex-wrap: wrap; }
        .charts-wrap { display: inline;}
        .m-line {  height: 280px; width: 450px; border: solid 1px; margin: 2px; }
        canvas{ margin-top: -11px  !important; margin-left: -3px  !important;}
        .commColor span {float: right !important;}
        .code_c { font-size: 12px;}
        .price_c {font-size: 12px; color: brown;}
       
    </style>
</head>

<body>
    <div id="main"></div>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="./js/charts-demo-data.js" type="text/javascript" charset="utf-8"></script>
    <script src="./js/charts-demo.js" type="text/javascript" charset="utf-8"></script>
    <script>
        let gerDiv = async (array)=>{
            let divStr =  ` <div class="charts-wrap"><span class="code_c">_code_</span>  <span class="price_c" id="_priceID_"></span>
                                <div id="m-line_num_" class="m-line"></div>
                            </div>`;
            var rt = "";
            for (let x = 0; x < array.length; x++) {
                var cname = await getCode2Name(array[x]);
                var _cname = `${cname.result[0][2]}(${array[x]})`;
                let str = divStr.replace('_num_',x).replace('_code_',_cname).replace('_priceID_','PriceID'+x)
                rt += str;
            }
            $("#main").html(rt);
        }
        async function  getDataAll(_el,_x)  {
            eval("var mchart"+ _x +" =  echarts.init(document.getElementById('m-line"+ _x +"'));");
            let res = await  getmData(_el);  
            let res2 = await getInfo(_el);  
            res.yestclose = res2[2];// [2]昨日收盘价[3]当前最新价[33]当前时间
            let nowPrice = `　　　　${res2[3]} (${res2[31]})`
            $("#PriceID" + _x).html(nowPrice);
            (eval("mchart"+_x)).setOption(initMOption(res, 'hs'));
        }
        (async()=>{
            let array = ['000001','601066','512880','002142']
            await gerDiv(array);
            var t = new Date();//你已知的时间
            str = t.getHours().toString() + t.getMinutes().toString(); 
            if(parseInt(str) < 1501 ) {
                for (let x = 0; x < array.length; x++) {
                    setInterval(function (Inter) { getDataAll(array[x], x);}, 5000)
                }
            }else{
                for (let x = 0; x < array.length; x++) {
                    getDataAll(array[x], x);
                }
            }
        })()
        //循环获取数据
    </script>
</body>

</html>