<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSON to Table</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style> table { border-collapse: collapse; width: 100%; }
   th, td {
     padding: 3px;
     text-align: left;
     border-bottom: 1px solid #827f7f;
     font-size: 12px;
   }
   
   th {
     background-color: #f2f2f2;
   }
   </style>
</head>
<body>

<input type="text" id="inputParam" value="2023-7"> 
<input type="text" id="mySelect" value="工程项目结算审核流程"> 

<button onclick="fetchJson()">获取数据</button><br><br>
<table id="myTable" border="1">
  <thead>
    <tr></tr> <!-- 表头将在 JavaScript 中生成 -->
  </thead>
  <tbody></tbody> <!-- 表格内容将在 JavaScript 中生成 -->
</table>

<script>
$(document).ready(function() {
   // 页面加载完成后立即执行 fetchJson()
   fetchJson();
});

function fetchJson() {
   var seleItem = $('#mySelect').val();

   // 清空表格内容
   $('tbody').empty();
   $('thead tr').empty();

   // 获取输入框的值作为参数
   var inputParam = $('#inputParam').val();

   $.ajax({
      url: '/all?seleItem='+ seleItem +'&data=' + inputParam,
      dataType: 'json',
      success: function(data) {
         var tableHeaders = Object.keys(data[0]);
         var tableRows = '';

         // 创建表头
         for (var i = 0; i < tableHeaders.length; i++) {
            $('thead tr').append('<th>' + tableHeaders[i] + '</th>');
         }

         // 创建表格内容
         for (var j = 0; j < data.length; j++) {
            var rowData = Object.values(data[j]);

            tableRows += '<tr>';
            for (var k = 0; k < rowData.length; k++) {
               if(k==0){
                  tableRows += '<td><a href="content.html?flowCode=' + rowData[k] + '" target="_blank">' + rowData[k] + '</a></td>';
               }else{
                  tableRows += '<td>' + rowData[k] + '</td>';
               }
               
            }
            tableRows += '</tr>';
         }

        $('tbody').append(tableRows);
     },
     error: function(error) {
        console.log('获取数据失败:', error);
     }
   });
}
</script>

</body>
</html>